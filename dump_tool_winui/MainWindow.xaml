<Window
    x:Class="SkyrimDiagDumpToolWinUI.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:SkyrimDiagDumpToolWinUI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Tullius CTD Logger - Modern Viewer">

  <Grid>
    <Grid.Background>
      <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
        <GradientStop Color="#FFF1F7FF" Offset="0" />
        <GradientStop Color="#FFE5F2FF" Offset="0.55" />
        <GradientStop Color="#FFF2F8F5" Offset="1" />
      </LinearGradientBrush>
    </Grid.Background>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
      <StackPanel Margin="20" Spacing="14">
        <Border
            Background="{ThemeResource CardBackgroundBrush}"
            BorderBrush="{ThemeResource CardBorderBrush}"
            BorderThickness="1"
            CornerRadius="16"
            Padding="18">
          <StackPanel Spacing="4">
            <TextBlock FontFamily="Bahnschrift" FontSize="30" FontWeight="SemiBold" Foreground="{ThemeResource HeaderBrush}">
              Tullius CTD Logger
            </TextBlock>
            <TextBlock FontSize="15" Foreground="{ThemeResource SubtleTextBrush}" TextWrapping="Wrap">
              Full WinUI viewer: beginner summary plus advanced diagnostics in one window.
            </TextBlock>
          </StackPanel>
        </Border>

        <Border
            Background="{ThemeResource CardBackgroundBrush}"
            BorderBrush="{ThemeResource CardBorderBrush}"
            BorderThickness="1"
            CornerRadius="16"
            Padding="16">
          <StackPanel Spacing="10">
            <TextBlock FontSize="17" FontWeight="SemiBold" Foreground="{ThemeResource HeaderBrush}">
              Analyze Dump
            </TextBlock>

            <Grid ColumnSpacing="8">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <TextBox x:Name="DumpPathBox" PlaceholderText="Select a .dmp file" />
              <Button Grid.Column="1" Click="BrowseDump_Click" Content="Browse dump" />
            </Grid>

            <Grid ColumnSpacing="8">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <TextBox x:Name="OutputDirBox" PlaceholderText="Optional output directory (empty = dump folder)" />
              <Button Grid.Column="1" Click="BrowseOutputFolder_Click" Content="Browse folder" />
            </Grid>

            <StackPanel Orientation="Horizontal" Spacing="8">
              <Button x:Name="AnalyzeButton" Click="AnalyzeButton_Click" Content="Analyze now" />
              <Button x:Name="OpenOutputButton" Click="OpenOutputButton_Click" Content="Open report folder" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
              <ProgressRing x:Name="BusyRing" Width="20" Height="20" IsActive="False" />
              <TextBlock x:Name="StatusText" Foreground="{ThemeResource SubtleTextBrush}" Text="Ready." TextWrapping="Wrap" />
            </StackPanel>
          </StackPanel>
        </Border>

        <Grid ColumnSpacing="12">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1.2*" />
            <ColumnDefinition Width="*" />
          </Grid.ColumnDefinitions>

          <Border
              Grid.Column="0"
              Background="{ThemeResource CardBackgroundBrush}"
              BorderBrush="{ThemeResource CardBorderBrush}"
              BorderThickness="1"
              CornerRadius="16"
              Padding="16">
            <StackPanel Spacing="8">
              <TextBlock FontSize="18" FontWeight="SemiBold" Foreground="{ThemeResource HeaderBrush}">
                Crash Snapshot
              </TextBlock>
              <TextBlock x:Name="SummarySentenceText" Text="No analysis yet." TextWrapping="WrapWholeWords" FontSize="16" />
              <TextBlock x:Name="BucketText" Foreground="{ThemeResource SubtleTextBrush}" TextWrapping="WrapWholeWords" />
              <TextBlock x:Name="ModuleText" Foreground="{ThemeResource SubtleTextBrush}" TextWrapping="WrapWholeWords" />
              <TextBlock x:Name="ModNameText" Foreground="{ThemeResource SubtleTextBrush}" TextWrapping="WrapWholeWords" />
            </StackPanel>
          </Border>

          <Border
              Grid.Column="1"
              Background="{ThemeResource CardBackgroundBrush}"
              BorderBrush="{ThemeResource CardBorderBrush}"
              BorderThickness="1"
              CornerRadius="16"
              Padding="16">
            <StackPanel Spacing="8">
              <TextBlock FontSize="18" FontWeight="SemiBold" Foreground="{ThemeResource HeaderBrush}">
                Recommended Next Steps
              </TextBlock>
              <ListView x:Name="RecommendationsList" MaxHeight="280" SelectionMode="None">
                <ListView.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding}" TextWrapping="WrapWholeWords" />
                  </DataTemplate>
                </ListView.ItemTemplate>
              </ListView>
            </StackPanel>
          </Border>
        </Grid>

        <Border
            Background="{ThemeResource CardBackgroundBrush}"
            BorderBrush="{ThemeResource CardBorderBrush}"
            BorderThickness="1"
            CornerRadius="16"
            Padding="16">
          <StackPanel Spacing="8">
            <TextBlock FontSize="18" FontWeight="SemiBold" Foreground="{ThemeResource HeaderBrush}">
              Top Cause Candidates
            </TextBlock>
            <ListView x:Name="SuspectsList" SelectionMode="None">
              <ListView.ItemTemplate>
                <DataTemplate x:DataType="local:SuspectItem">
                  <StackPanel Spacing="3" Margin="0,0,0,8">
                    <TextBlock FontWeight="SemiBold" Text="{x:Bind Module}" TextWrapping="WrapWholeWords" />
                    <TextBlock Foreground="{ThemeResource AccentBrush}" Text="{x:Bind Confidence}" />
                    <TextBlock Text="{x:Bind Reason}" TextWrapping="WrapWholeWords" />
                  </StackPanel>
                </DataTemplate>
              </ListView.ItemTemplate>
            </ListView>
          </StackPanel>
        </Border>

        <Border
            Background="{ThemeResource CardBackgroundBrush}"
            BorderBrush="{ThemeResource CardBorderBrush}"
            BorderThickness="1"
            CornerRadius="16"
            Padding="16">
          <StackPanel Spacing="10">
            <TextBlock FontSize="18" FontWeight="SemiBold" Foreground="{ThemeResource HeaderBrush}">
              Advanced Analysis (Built-in)
            </TextBlock>

            <TextBlock FontWeight="SemiBold" Text="Callstack" />
            <ListView x:Name="CallstackList" MaxHeight="200" SelectionMode="None">
              <ListView.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding}" TextWrapping="WrapWholeWords" FontFamily="Cascadia Mono" />
                </DataTemplate>
              </ListView.ItemTemplate>
            </ListView>

            <TextBlock FontWeight="SemiBold" Text="Evidence" />
            <ListView x:Name="EvidenceList" MaxHeight="220" SelectionMode="None">
              <ListView.ItemTemplate>
                <DataTemplate x:DataType="local:EvidenceViewItem">
                  <StackPanel Spacing="2" Margin="0,0,0,8">
                    <TextBlock Foreground="{ThemeResource AccentBrush}" Text="{x:Bind Confidence}" />
                    <TextBlock FontWeight="SemiBold" Text="{x:Bind Title}" TextWrapping="WrapWholeWords" />
                    <TextBlock Text="{x:Bind Details}" TextWrapping="WrapWholeWords" />
                  </StackPanel>
                </DataTemplate>
              </ListView.ItemTemplate>
            </ListView>

            <TextBlock FontWeight="SemiBold" Text="Recent Resources" />
            <ListView x:Name="ResourcesList" MaxHeight="220" SelectionMode="None">
              <ListView.ItemTemplate>
                <DataTemplate x:DataType="local:ResourceViewItem">
                  <StackPanel Spacing="2" Margin="0,0,0,8">
                    <TextBlock FontWeight="SemiBold" Text="{x:Bind Path}" TextWrapping="WrapWholeWords" />
                    <TextBlock Text="{x:Bind Kind}" Foreground="{ThemeResource AccentBrush}" />
                    <TextBlock Text="{x:Bind Providers}" TextWrapping="WrapWholeWords" />
                    <TextBlock Text="{x:Bind Conflict}" Foreground="#FFB00020" />
                  </StackPanel>
                </DataTemplate>
              </ListView.ItemTemplate>
            </ListView>

            <TextBlock FontWeight="SemiBold" Text="Events (Blackbox)" />
            <ListView x:Name="EventsList" MaxHeight="220" SelectionMode="None">
              <ListView.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding}" TextWrapping="WrapWholeWords" FontFamily="Cascadia Mono" />
                </DataTemplate>
              </ListView.ItemTemplate>
            </ListView>

            <TextBlock FontWeight="SemiBold" Text="WCT JSON" />
            <TextBox
                x:Name="WctTextBox"
                IsReadOnly="True"
                AcceptsReturn="True"
                TextWrapping="NoWrap"
                FontFamily="Cascadia Mono"
                MinHeight="120"
                MaxHeight="260" />

            <TextBlock FontWeight="SemiBold" Text="Report" />
            <TextBox
                x:Name="ReportTextBox"
                IsReadOnly="True"
                AcceptsReturn="True"
                TextWrapping="Wrap"
                MinHeight="140"
                MaxHeight="300" />
          </StackPanel>
        </Border>
      </StackPanel>
    </ScrollViewer>
  </Grid>
</Window>
